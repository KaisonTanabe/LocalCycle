<% available = current_user.producer? ? Agreement.by_product(p.id).available_demand : Agreement.by_product(p.id).available_supply %>
<tr>
  <td class='name <%= (params[:sort] == "name") ? "sorted" : "" %>'>
    <%= image_tag p.best_pic_url(:thumb), class: "thumb" %>
    
    <h5><%= link_to p.name, "#" %>
      <% if available.any? %>
       <small><%= pluralize(available.count, (current_user.buyer? ? "producer" : "buyer")) %></small>
      <% end %>
      <br />
      <%= link_to "Propose an Agreement", new_agreement_path(product_id: p.id), class: "btn btn-mini btn-primary" %>
    </h5>
  </td>
  <td colspan="12">
    <% if available.any? %>
      <% available.each do |a| %>
        <%= render partial: "agreement_bar", locals: {a: a} %>
      <% end %>
    <% else %>
      <em>General harvest calendar availability bar here</em>
      <!--a class="bar" style="margin-left: 49%; margin-right: 22%;" href="#myModal"></a-->
    <% end %>
  </td>
</tr>
