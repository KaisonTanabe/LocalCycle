<%= form_for(@agreement, html: { multipart: true, class: "form-horizontal" }) do |f| %>
  
  <legend></legend>
  <%= render partial: 'partials/errors', locals: {obj: @agreement} %>
  <p><span class="label label-info">Instructions:</span> Start typing a product name. Then select your product to auto-populate options<br />&nbsp;</p>

<div class="row">
  <div class="span6">
    <div class="control-group">
      <label class="req control-label" for="agreement_product_id">Product:</label>
      <div class="controls controls-row">
	<%= f.select :product_id, option_groups_from_collection_for_select(Category.includes(:products).order('name'), :products, :name, :id, :name, (@agreement.new_record? ? "" : @agreement.product.id)), {prompt: "-- Please type and select --"}, {class: "select2 span4" } %>
      </div>
    </div>

    <div class="control-group">
      <%= f.label :name, "Name/Title:", class: "control-label" %>
      <div class="controls controls-row">
	<%= f.text_field :name, class: "span4" %>
	<span class="help-inline">Further differentiate <%= current_user.producer? ? "your product" : "your need" %>.<br />
	  Ex. "English Cucumbers, fresh organic"</span>
      </div>
    </div>

    <div class="control-group">
      <%= f.label :description, "Description:", class: "control-label" %>
      <div class="controls controls-row">
	<%= f.text_area :description, rows: 4, class: "span4" %>
	<span class="help-inline">(optional) Add a detailed description<%= current_user.producer? ? "." : " of what you are looking for." %></span>
      </div>
    </div>

    <% if current_user.producer? %>
    <div class="control-group">
      <%= f.label :locally_packaged, "Locally Packaged:", class: "control-label" %>
      <div class="controls control-row">
	<label class="checkbox"><%= f.check_box :locally_packaged %> Check this box if this product locally packaged, but not grown or raised locally.</label>
      </div>
    </div>
    <% end %>
  </div>

  <div class="span6">
    <%= f.fields_for :images do |fa| %>
    <div class="control-group">
      <%= fa.label :image, "Thumbnail: ", class: "req control-label" %>
      <% if fa.object.new_record? %>
        <div class="controls controls-row">
	  <div id="product_pic_div" style="padding: 10px 2px;"></div>
 	  <%= fa.file_field :image, rows: 4, class: "span4" %>
	</div>
      <% else %>
        <div class="controls controls-row child-field" style="padding: 5px;" >
	  <% if !@agreement.images.any? %><div id="product_pic_div"></div><% end %>
	  <%= image_tag @agreement.images[0].image.url(:medium) %>
	  <span class="help-inline"><%= link_to raw('<span class="icon-white icon-remove"></span> Remove'), 'javascript:void(0)', class: 'remove-old-child btn btn-mini btn-inverse' %></span>
	  <%= fa.hidden_field :_destroy, class: 'destroy-field', value: '0' %>
	</div>
      <% end %>
      <div class="controls">
	<span class="help-block">Upload an image to use instead of the default. 2MB Limit.</span>
      </div>
    </div>
    <% end %>

  </div>
</div>

<% if params["agreement_type"] == "onetime" %>
<div class="row">
  <div class="span12">
    <legend>Pricing Options</legend>
    <%= f.hidden_field :agreement_type, value: "onetime" %>
  </div>
  <div class="span6">
    <div class="control-group">
      <%= f.label :selling_unit, "Selling Unit:", class: "control-label" %>
      <div class="controls controls-row">
	<%= f.select :selling_unit, UNIT_TYPE.map {|u| [u.second, u.first]}, {prompt: "-- Please select --"}, {class: "span3"} %>
      </div>
    </div>

    <div class="control-group">
      <%= f.label :price, "Price Per Unit:", class: "control-label" %>
      <div class="controls controls-row">
	<div class="input-prepend">
	  <span class="add-on">$</span>
	  <%= f.text_field :price, placeholder: "0.00", class: "span2" %>
	</div>
	<span class="help-inline">Unit selected above</span>
      </div>
    </div>

    <div class="control-group">
      <%= f.label :quantity, "Quantity:", class: "control-label" %>
      <div class="controls controls-row">
 	<div class="input-append">
	  <%= f.text_field :quantity, placeholder: "0", class: "span2" %>
	  <span class="add-on" id="quantity_add_on"></span>
	</div>
	<span class="help-inline">Number of units <%= current_user.buyer? ? "demanded" : "available" %></span>
      </div>
    </div>
  </div>
</div>
<% else %>
<div class="row">
  <div class="span12">
    <legend>Agreement Options</legend>
  </div>

  <div class="span12">
    <p><em>LocalCycle</em> gives you the ability to propose <em>one-time</em>, repeating <em>seasonal</em>, or repeating <em>indefinite</em> contract periods for your agreement.<br />
      (Repeating deliveries can occur with <em>weekly</em> or <em>monthly</em> frequency.)</p>
    <div class="control-group">
      <%= f.label :agreement_type, "Agreement Type:", class: "control-label" %>
      <div class="controls controls-row">
	<%= f.select :agreement_type, AGREEMENT_TYPES.map {|u| [u.second, u.first]}, {prompt: "-- Please select --"}, {class: "span4"} %>
      </div>
    </div>
  </div>
 
  <div class="span6">
    <div class="dfagreement_agreement_type dfindefinite dfseasonal dfonetime">
      <div class="control-group">
	<%= f.label :selling_unit, "Selling Unit:", class: "control-label" %>
	<div class="controls controls-row">
	  <%= f.select :selling_unit, UNIT_TYPE.map {|u| [u.second, u.first]}, {prompt: "-- Please select --"}, {class: "span3"} %>
	</div>
      </div>

      <div class="control-group">
	<%= f.label :price, "Price Per Unit:", class: "control-label" %>
	<div class="controls controls-row">
	  <div class="input-prepend">
	    <span class="add-on">$</span>
	    <%= f.text_field :price, placeholder: "0.00", class: "span2" %>
	  </div>
	  <span class="help-inline">Unit selected above</span>
	</div>
      </div>

      <div class="control-group">
	<%= f.label :quantity, "Quantity:", class: "control-label" %>
	<div class="controls controls-row">
 	  <div class="input-append">
	    <%= f.text_field :quantity, placeholder: "0", class: "span2" %>
	    <span class="add-on" id="quantity_add_on"></span>
	  </div>
	  <span class="help-inline">Number of units <%= current_user.buyer? ? "demanded" : "available" %> <span class="dfagreement_frequency dfweekly">(per weekly delivery)</span><span class="dfagreement_frequency dfmonthly">(per monthly delivery)</span></span>
	</div>
      </div>
    </div>
  </div>

  <div class="span6">
    <div class="dfagreement_agreement_type dfindefinite dfseasonal">
      <div class="control-group">
	<%= f.label :frequency, "Frequency:", class: "control-label" %>
	<div class="controls controls-row">
	  <%= f.select :frequency, FREQUENCIES.map {|u| [u.second, u.first]}, {prompt: "-- Please select --"}, {class: "span4"} %>
	</div>
      </div>
    </div>
    <div class="dfagreement_agreement_type dfseasonal">
      <div class="control-group">
	<%= f.label :start_date, "Begin Date:", class: "control-label" %>
	<div class="controls controls-row controls-date">
	  <%= f.date_select :start_date, :prompt => true, :order => [:month, :day, :year] %>
	  <span class="help-inline">First week of agreement period</span>
	</div>
      </div>    
      <div class="control-group">
	<%= f.label :end_date, "End Date:", class: "control-label" %>
	<div class="controls controls-row controls-date">
	  <%= f.date_select :end_date, :prompt => true, :order => [:month, :day, :year] %>
	  <span class="help-inline">Last week of agreement period</span>
	</div>
      </div>
    </div>

    <div class="dfagreement_agreement_type dfonetime">
      <div class="control-group">
	<%= f.label :start_date, "Date:", class: "control-label" %>
	<div class="controls controls-row controls-date">
	  <%= f.date_select :start_date, :prompt => true, :order => [:month, :day, :year] %>
	  <span class="help-inline">Date <%= current_user.producer? ? "your product is available" : "product is needed" %></span>
	</div>
      </div>
    </div>
  </div>
</div>
<% end %>


<div class="row">
  <div class="span12">
    <p><br /></p>
    <legend>Delivery Options</legend>
  </div>

  <% if current_user.producer? %>
  <div class="span6">
    <div class="control-group">
      <%= f.label :can_deliver, "Can Deliver?", class: "control-label" %>
      <div class="controls control-row">
	<label class="radio" for="agreement_can_deliver_true"><%= f.radio_button :can_deliver, true, class: "yes" %> YES</label>
	<label class="radio" for="agreement_can_deliver_true"><%= f.radio_button :can_deliver, false, class: "no" %> No</label>
      </div>
    </div>
    
    <div class="control-group">
      <%= f.label :delivery_options, "Delivery Instructions:", class: "control-label" %>
      <div class="controls control-row">
	<%= f.text_area :delivery_options, rows: 4, class: "span4" %>
      </div>
    </div>
  </div>

  <% elsif current_user.buyer? %>

  <div class="span6">
    <div class="control-group">
      <%= f.label :can_pickup, "Can Pickup?", class: "control-label" %>
      <div class="controls control-row">
	<label class="radio" for="agreement_can_pickup_true"><%= f.radio_button :can_pickup, true, class: "yes" %> YES</label>
	<label class="radio" for="agreement_can_pickup_true"><%= f.radio_button :can_pickup, false, class: "no" %> No</label>
      </div>
    </div>
    

    <div class="control-group">
      <%= f.label :pickup_options, "Pickup Instructions:", class: "control-label" %>
      <div class="controls control-row">
	<%= f.text_area :pickup_options, rows: 4, class: "span4" %>
      </div>
    </div>
  </div>
  <% end %>
</div>

<hr style="clear: both;" />
  
  <%= render partial: 'partials/submit', locals: {f: f, text: 'Agreement'} %>

<% end %>
