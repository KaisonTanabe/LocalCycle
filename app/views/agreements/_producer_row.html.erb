<% producers = ProducerProfile.scoped.order_best_available %>
<% producers = producers.by_size(params[:size]) unless params[:size].blank? %>
<% producers = producers.by_growing_methods(params[:growing_methods]) unless params[:growing_methods].blank? %>

<tr id="collapse<%= p.id %>">
  <td class="row-collapse">
    <a id="toggle">
      <i class="icon-plus" some="#collapse<%= p.id %>"></i>
    </a>
  </td>
  <td class='name <%= (params[:sort] == "name") ? "sorted" : "" %>'>
    <div class="collapsable">
      <div class="topDisplay">
	<%= image_tag p.best_pic_url(:thumb), class: "thumb" %>    
	<h5><%= link_to p.name, "#" %>
	  <% if false %>
	  <small><%= pluralize(agreements.count, "producer") %></small>
	  <% end %>
	  <br />
	  <%= link_to "Post Demand Agreement", new_agreement_path(product_id: p.id), class: "btn btn-mini btn-primary" %>
	</h5>
      </div>
      <% producers.each do |profile| %>
        <div class="producer_col"><%= render partial: "producer_profiles/first_col", locals: {profile: profile, p: p} %></div>
      <% end %>
    </div>
  </td>
  <td colspan="12">
  <div class="collapsable">
    <div class="topDisplay">
      [<em>General harvest calendar availability bar here</em>]
    </div>
      <% producers.each do |profile| %>
        <div class="producer_col"><%= render partial: "producer_profiles/second_col", locals: {profile: profile, p: p} %></div>
      <% end %>
  </div>
  </td>
</tr>
